---
import CalculatorStep from '@elements/Calculator/CalculatorStep.astro'

import ColorOption, {
  type Props as ColorOptionProps,
} from '@elements/ColorOption.astro'

export interface Props {
  cards?: Array<ColorOptionProps>
}

const {
  cards = [
    // Профнастил
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 7004',
      name: 'Серый',
      checked: true,
      filter: 'fence-type: Профнастил',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 7004',
      name: 'серый',
      checked: true,
      filter: 'fence-type: Профнастил',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 3003',
      name: 'рубин',
      checked: true,
      filter: 'fence-type: Профнастил',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 3005',
      name: 'красное вино',
      checked: true,
      filter: 'fence-type: Профнастил',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 8017',
      name: 'шоколад',
      checked: true,
      filter: 'fence-type: Профнастил',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 6002',
      name: 'светл.зеленый',
      checked: true,
      filter: 'fence-type: Профнастил',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 6005',
      name: 'темно зеленый',
      checked: true,
      filter: 'fence-type: Профнастил',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 5021',
      name: 'морская волна',
      checked: true,
      filter: 'fence-type: Профнастил',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 5005',
      name: 'синий',
      checked: true,
      filter: 'fence-type: Профнастил',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 5002',
      name: 'ультрамарин',
      checked: true,
      filter: 'fence-type: Профнастил',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 7024',
      name: 'мокрый асфальт',
      checked: true,
      filter: 'fence-type: Профнастил',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 9005',
      name: 'черный',
      checked: true,
      filter: 'fence-type: Профнастил',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 1018',
      name: 'желтый',
      checked: true,
      filter: 'fence-type: Профнастил',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 1015',
      name: 'слоновая кость',
      checked: true,
      filter: 'fence-type: Профнастил',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 9030',
      name: 'белый',
      checked: true,
      filter: 'fence-type: Профнастил',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 9002',
      name: 'белая ночь',
      checked: true,
      filter: 'fence-type: Профнастил',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'Под дерево',
      name: '',
      checked: true,
      filter: 'fence-type: Профнастил',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'Под под камень',
      name: '',
      checked: true,
      filter: 'fence-type: Профнастил',
    },

    // Евроштакетник
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 7004',
      name: 'серый',
      checked: true,
      filter: 'fence-type: Евроштакетник',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 3003',
      name: 'рубин',
      checked: true,
      filter: 'fence-type: Евроштакетник',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 3005',
      name: 'красное вино',
      checked: true,
      filter: 'fence-type: Евроштакетник',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 8017',
      name: 'шоколад',
      checked: true,
      filter: 'fence-type: Евроштакетник',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 6002',
      name: 'светл.зеленый',
      checked: true,
      filter: 'fence-type: Евроштакетник',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 6005',
      name: 'темно зеленый',
      checked: true,
      filter: 'fence-type: Евроштакетник',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 5021',
      name: 'морская волна',
      checked: true,
      filter: 'fence-type: Евроштакетник',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 5005',
      name: 'синий',
      checked: true,
      filter: 'fence-type: Евроштакетник',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 5002',
      name: 'ультрамарин',
      checked: true,
      filter: 'fence-type: Евроштакетник',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 7024',
      name: 'мокрый асфальт',
      checked: true,
      filter: 'fence-type: Евроштакетник',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 9005',
      name: 'черный',
      checked: true,
      filter: 'fence-type: Евроштакетник',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 1018',
      name: 'желтый',
      checked: true,
      filter: 'fence-type: Евроштакетник',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 1015',
      name: 'слоновая кость',
      checked: true,
      filter: 'fence-type: Евроштакетник',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 9030',
      name: 'белый',
      checked: true,
      filter: 'fence-type: Евроштакетник',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 9002',
      name: 'белая ночь',
      checked: true,
      filter: 'fence-type: Евроштакетник',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'Под дерево',
      name: '',
      checked: true,
      filter: 'fence-type: Евроштакетник',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'Под под камень',
      name: '',
      checked: true,
      filter: 'fence-type: Евроштакетник',
    },

    // 3D сетка Гиттер
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 1705',
      name: 'темно зеленый',
      checked: true,
      filter: 'fence-type: 3D сетка Гиттер',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 5005',
      name: 'синий',
      checked: true,
      filter: 'fence-type: 3D сетка Гиттер',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 8017',
      name: 'шоколад',
      checked: true,
      filter: 'fence-type: 3D сетка Гиттер',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 1705',
      name: 'темно зеленый',
      checked: true,
      filter: 'fence-type: 3D сетка Гиттер',
    },

    // 2D сварная сетка
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 1705',
      name: 'темно зеленый',
      checked: true,
      filter: 'fence-type: 2D сварная сетка',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 5005',
      name: 'синий',
      checked: true,
      filter: 'fence-type: 2D сварная сетка',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 8017',
      name: 'шоколад',
      checked: true,
      filter: 'fence-type: 2D сварная сетка',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 1705',
      name: 'темно зеленый',
      checked: true,
      filter: 'fence-type: 2D сварная сетка',
    },

    // Деревянный шаткетник:
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'Естественный, без окраса',
      name: '',
      checked: true,
      filter: 'fence-type: Деревянный шаткетник',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'С окрасом',
      name: '',
      checked: true,
      filter: 'fence-type: Деревянный шаткетник',
    },

    // Сетка рабица
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 1705',
      name: 'темно зеленый',
      checked: true,
      filter: 'fence-type: Сетка рабица',
    },

    // Поликарбонат
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'Прозрачный',
      name: '',
      checked: true,
      filter: 'fence-type: Поликарбонат',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'Молоко',
      name: '',
      checked: true,
      filter: 'fence-type: Поликарбонат',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'Бронза',
      name: '',
      checked: true,
      filter: 'fence-type: Поликарбонат',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'Зеленый',
      name: '',
      checked: true,
      filter: 'fence-type: Поликарбонат',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'Синий',
      name: '',
      checked: true,
      filter: 'fence-type: Поликарбонат',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'Красный',
      name: '',
      checked: true,
      filter: 'fence-type: Поликарбонат',
    },

    // Жалюзи
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 7004',
      name: ' серый',
      checked: true,
      filter: 'fence-type: Жалюзи',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 3005',
      name: ' красное вино',
      checked: true,
      filter: 'fence-type: Жалюзи',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 8017',
      name: ' шоколад',
      checked: true,
      filter: 'fence-type: Жалюзи',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 6005',
      name: ' темно зеленый',
      checked: true,
      filter: 'fence-type: Жалюзи',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 7024',
      name: ' мокрый асфальт',
      checked: true,
      filter: 'fence-type: Жалюзи',
    },
    {
      image: '/images/colors/1.jpg',
      color: '#9B9B9B',
      id: 'RAL 9005',
      name: ' черный',
      checked: true,
      filter: 'fence-type: Жалюзи',
    },
  ],
} = Astro.props
---

<CalculatorStep
  type={'content'}
  name="Выберите цвет"
>
  <e-calculator-colors class="calculator__color-options">
    {
      cards.map((card) => {
        return (
          <ColorOption
            {...card}
            class="calculator__color-option hide"
            filter={card.filter}
            type={'input'}
            required
            inputName={'fence-color'}
          />
        )
      })
    }
  </e-calculator-colors>
</CalculatorStep>

<style is:global>
  .calculator__color-options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2.5rem 5rem;

    @media (max-width: 768px) {
      gap: 1.5rem;
      max-height: 22.9rem;
    }
  }

  .calculator__color-option {
    --unchecked-color: 255;
    --checked-color: 250;
  }
</style>

<script>
  import type { CalculatorElement } from '@elements/Calculator/Calculator.astro.0.mjs'

  export class CalculatorColorsElement extends HTMLElement {
    #calculatorElement: CalculatorElement | null = null
    #colorInputElements: Array<HTMLInputElement> = []
    #infoElement: HTMLElement | null = null
    #imageElement: HTMLImageElement | null = null

    protected async connectedCallback() {
      this.#calculatorElement = this.closest('e-calculator')

      if (this.#calculatorElement) {
        this.#colorInputElements = [
          ...this.querySelectorAll<HTMLInputElement>('.color-option__input'),
        ]

        this.#colorInputElements.forEach((el) => {
          el.addEventListener('change', this.#inputListener)
        })

        this.#imageElement = this.#calculatorElement.querySelector(
          '.calculator-color-info__image',
        )

        this.#infoElement = this.#calculatorElement.querySelector(
          '.calculator-color-info',
        )

        await customElements.whenDefined('image-cloak')

        this.#calculatorElement?.addEventListener(
          'calculatorStepChange',
          this.#stepChangeListener,
        )

        this.#updateInfo()
      } else {
        console.warn(this, 'Не найден калькулятор')
      }
    }

    protected disconnectedCallback() {
      this.#colorInputElements.forEach((el) => {
        el.removeEventListener('change', this.#inputListener)
      })

      this.#calculatorElement?.removeEventListener(
        'calculatorStepChange',
        this.#stepChangeListener,
      )
    }

    #inputListener = (e: Event) => {
      const ct = e.currentTarget as HTMLInputElement

      const image = ct.getAttribute('data-image')

      if (image && this.#imageElement) {
        this.#imageElement.srcset = image
      }
    }

    #updateInfo() {
      const lastChecked = this.#colorInputElements.find((element) => {
        return !element.disabled
      })

      if (lastChecked) {
        lastChecked.checked = true

        const image = lastChecked.getAttribute('data-image')

        if (image && this.#imageElement) {
          this.#imageElement.srcset = image
        }

        if (this.#infoElement) {
          this.#infoElement.style.display = ''
        }
      } else {
        if (this.#infoElement) {
          this.#infoElement.style.display = 'none'
        }
      }
    }

    #stepChangeListener = () => {
      this.#updateInfo()
    }
  }

  if (!customElements.get('e-calculator-colors')) {
    customElements.define('e-calculator-colors', CalculatorColorsElement)
  }

  declare global {
    interface HTMLElementTagNameMap {
      'e-calculator-colors': CalculatorColorsElement
    }
  }
</script>
