---
import FormInput from './FormInput.astro'
import Icon from './Icon.astro'

export interface Props {
  class?: string
}

const { class: className, ...rest } = Astro.props
---

<FormInput
  {...rest}
  class={`${className || ''} calendar-input`}
  disabled
  placeholder="Дата монтажа"
  name="date"
  tag="e-calendar-input"
  tabindex="0"
  target="calendar"
>
  <Icon
    name={'calendar'}
    class="calendar-input__icon"
  />
</FormInput>

<style is:global>
  .calendar-input {
    cursor: pointer;

    .form-input__input {
      cursor: inherit;
    }
  }

  .calendar-input__icon {
    position: absolute;
    top: 50%;
    right: 2rem;

    width: 1.9rem;
    height: 1.9rem;

    fill: var(--color-grayscale-400);

    transform: translateY(-50%);

    @media (max-width: 768px) {
      right: 1.3rem;

      width: 1.4rem;
      height: 1.4rem;
    }
  }
</style>

<script>
  import { PopoverButtonElement } from 'aptechka/popover'

  export class CalendarInputElement extends PopoverButtonElement {
    #inputElement: HTMLInputElement | null = null

    public setValue(value: string) {
      if (this.#inputElement) {
        this.#inputElement.value = value
      }
    }

    protected override connectedCallback() {
      super.connectedCallback()
      this.#inputElement = this.querySelector('input')
    }
  }

  if (!customElements.get('e-calendar-input')) {
    customElements.define('e-calendar-input', CalendarInputElement)
  }

  declare global {
    interface HTMLElementTagNameMap {
      'e-calendar-input': CalendarInputElement
    }
  }
</script>
