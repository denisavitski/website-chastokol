---
import { typography } from '@utils/typography'
import type { HTMLAttributes } from 'astro/types'
import Icon from './Icon.astro'

export interface Props extends HTMLAttributes<any> {
  class?: string
  modal?: string
  href?: string
  name?: string
  theme?: 'default' | 'icon-right' | 'icon-left' | 'icon-only'
  font?: string | Array<string>
  hasLoadingState?: boolean
}

const {
  class: className,
  modal,
  target,
  href,
  theme = 'default',
  font = [typography.desktop['body-large-medium-16']],
  hasLoadingState = true,
  ...rest
} = Astro.props

let Tag = 'button' as any

if (modal) {
  Tag = 'e-popover-button'
} else if (href) {
  Tag = 'a'
}

const hasIcon =
  theme === 'icon-left' || theme === 'icon-right' || theme === 'icon-only'
---

<Tag
  {...rest}
  target={modal || target}
  href={href}
  class:list={[[font].flat(), 'primary-button', className]}
  data-theme={theme}
>
  <span class="primary-button__content">
    <span class="primary-button__name"><slot>Кнопка</slot></span>
    {
      hasIcon ? (
        <Icon
          class="primary-button__arrow"
          name={'tail-arrow'}
        />
      ) : null
    }
  </span>

  {
    hasLoadingState ? (
      <span class="primary-button__loading">
        <Icon
          class="primary-button__spinner"
          name={'loading'}
        />
      </span>
    ) : null
  }
</Tag>

<style is:global>
  .primary-button {
    --color: var(--color-button-text);

    position: relative;

    display: inline-block;

    height: var(--primary-button-height, 5rem);

    color: var(--color);
    background-color: var(--color-primary-100);
    border: 0.1rem solid transparent;
    border-radius: 18rem;
    cursor: pointer;

    overflow: hidden;

    transition-property: color, background-color, border-color;
    transition-duration: var(--duration-button);

    &[disabled],
    &[data-disabled] {
      --color: var(--color-button-text);
      background-color: var(--color-button-disabled);
      cursor: default;
    }

    &.loading {
      cursor: default;
    }

    @media (hover: hover) {
      &:not(.loading):not(disabled):not([data-disabled]):hover {
        --color: var(--color-primary-200);
        border-color: var(--color);
        background-color: transparent;
      }
    }
  }

  .primary-button__content {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;

    padding: var(--primary-button-padding, 0 2.5rem);

    .primary-button[data-theme='icon-left'] & {
      flex-direction: row-reverse;
      padding: var(--primary-button-padding, 0 2.35rem 0 2.45rem);
    }

    .primary-button[data-theme='icon-right'] & {
      padding: var(--primary-button-padding, 0 2.75rem 0 2.05rem);
    }

    .primary-button[data-theme='icon-only'] & {
      padding: var(--primary-button-padding, 0 2.2rem);
    }

    .primary-button.loading & {
      pointer-events: none;
      opacity: 0;
    }
  }

  .primary-button__name {
    display: var(--primary-button-name-display, block);

    .primary-button[data-theme='icon-only'] & {
      display: none;
    }
  }

  .primary-button__arrow {
    width: 1.6rem;
    height: 1.6rem;

    transition-property: stroke;
    transition-duration: var(--duration-button);

    stroke: var(--color);
    fill: none;
  }

  .primary-button__loading {
    position: absolute;
    top: 0;
    left: 0;

    width: 100%;
    height: 100%;

    display: flex;
    align-items: center;
    justify-content: center;

    opacity: 0;
    pointer-events: none;

    .primary-button.loading & {
      opacity: 1;
      pointer-events: auto;
    }
  }

  .primary-button__spinner {
    width: 2.4rem;
    height: 2.4rem;

    stroke: var(--color-grayscale-200);
    fill: none;

    transform-origin: 51.5% 50%;

    .primary-button.loading & {
      animation: button-loading 1s infinite linear;
    }
  }

  .primary-button__loading,
  .primary-button__content {
    width: 100%;
    height: 100%;

    transition-property: opacity;
    transition-duration: var(--duration-button);
  }

  @keyframes button-loading {
    100% {
      transform: rotate(1turn);
    }
  }
</style>
